"use strict";exports.id=924,exports.ids=[924],exports.modules={8924:(e,t,r)=>{r.r(t),r.d(t,{encodeIntoResult:()=>encodeIntoResult,stegaEncodeSourceMap:()=>stegaEncodeSourceMap,stegaEncodeSourceMap$1:()=>u});var n=r(8791);let i=/_key\s*==\s*['"](.*)['"]/;function isKeySegment(e){return"string"==typeof e?i.test(e.trim()):"object"==typeof e&&"_key"in e}function toString(e){if(!Array.isArray(e))throw Error("Path is not an array");return e.reduce((e,t,r)=>{let n=typeof t;if("number"===n)return`${e}[${t}]`;if("string"===n)return`${e}${0===r?"":"."}${t}`;if(isKeySegment(t)&&t._key)return`${e}[_key=="${t._key}"]`;if(Array.isArray(t)){let[r,n]=t;return`${e}[${r}:${n}]`}throw Error(`Unsupported path segment \`${JSON.stringify(t)}\``)},"")}let o={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},s={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function jsonPath(e){return`$${e.map(e=>"string"==typeof e?`['${e.replace(/[\f\n\r\t'\\]/g,e=>o[e])}']`:"number"==typeof e?`[${e}]`:""!==e._key?`[?(@._key=='${e._key.replace(/['\\]/g,e=>o[e])}')]`:`[${e._index}]`).join("")}`}function parseJsonPath(e){let t;let r=[],n=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;for(;null!==(t=n.exec(e));){if(void 0!==t[1]){let e=t[1].replace(/\\(\\|f|n|r|t|')/g,e=>s[e]);r.push(e);continue}if(void 0!==t[2]){r.push(parseInt(t[2],10));continue}if(void 0!==t[3]){let e=t[3].replace(/\\(\\')/g,e=>s[e]);r.push({_key:e,_index:-1});continue}}return r}function jsonPathToStudioPath(e){return e.map(e=>{if("string"==typeof e||"number"==typeof e)return e;if(""!==e._key)return{_key:e._key};if(-1!==e._index)return e._index;throw Error(`invalid segment:${JSON.stringify(e)}`)})}function jsonPathToMappingPath(e){return e.map(e=>{if("string"==typeof e||"number"==typeof e)return e;if(-1!==e._index)return e._index;throw Error(`invalid segment:${JSON.stringify(e)}`)})}function resolveMapping(e,t){if(!t?.mappings)return;let r=jsonPath(jsonPathToMappingPath(e));if(void 0!==t.mappings[r])return{mapping:t.mappings[r],matchedPath:r,pathSuffix:""};let n=Object.entries(t.mappings).filter(([e])=>r.startsWith(e)).sort(([e],[t])=>t.length-e.length);if(0==n.length)return;let[i,o]=n[0],s=r.substring(i.length);return{mapping:o,matchedPath:i,pathSuffix:s}}function isArray(e){return null!==e&&Array.isArray(e)}function isRecord(e){return"object"==typeof e&&null!==e}function walkMap(e,t,r=[]){if(isArray(e))return e.map((e,n)=>{if(isRecord(e)){let i=e._key;if("string"==typeof i)return walkMap(e,t,r.concat({_key:i,_index:n}))}return walkMap(e,t,r.concat(n))});if(isRecord(e)){if("block"===e._type||"span"===e._type){let n={...e};return"block"===e._type?n.children=walkMap(e.children,t,r.concat("children")):"span"===e._type&&(n.text=walkMap(e.text,t,r.concat("text"))),n}return Object.fromEntries(Object.entries(e).map(([e,n])=>[e,walkMap(n,t,r.concat(e))]))}return t(e,r)}function encodeIntoResult(e,t,r){return walkMap(e,(e,n)=>{if("string"!=typeof e)return e;let i=resolveMapping(n,t);if(!i)return e;let{mapping:o,matchedPath:s}=i;if("value"!==o.type||"documentValue"!==o.source.type)return e;let a=t.documents[o.source.document],l=t.paths[o.source.path],u=parseJsonPath(s),p=parseJsonPath(l).concat(n.slice(u.length));return r({sourcePath:p,sourceDocument:a,resultPath:n,value:e})})}let a="drafts.";function isDraftId(e){return e.startsWith(a)}function isVersionId(e){return e.startsWith("versions.")}function isPublishedId(e){return!isDraftId(e)&&!isVersionId(e)}function getVersionFromId(e){if(!isVersionId(e))return;let[t,r,...n]=e.split(".");return r}function getPublishedId(e){return isVersionId(e)?e.split(".").slice(2).join("."):isDraftId(e)?e.slice(a.length):e}function createEditUrl(e){let{baseUrl:t,workspace:r="default",tool:n="default",id:i,type:o,path:s,projectId:a,dataset:l}=e;if(!t)throw Error("baseUrl is required");if(!s)throw Error("path is required");if(!i)throw Error("id is required");if("/"!==t&&t.endsWith("/"))throw Error("baseUrl must not end with a slash");let u="default"===r?void 0:r,p="default"===n?void 0:n,d=getPublishedId(i),c=Array.isArray(s)?toString(jsonPathToStudioPath(s)):s,f=new URLSearchParams({baseUrl:t,id:d,type:o,path:c});if(u&&f.set("workspace",u),p&&f.set("tool",p),a&&f.set("projectId",a),l&&f.set("dataset",l),isPublishedId(i))f.set("perspective","published");else if(isVersionId(i)){let e=getVersionFromId(i);f.set("perspective",e)}let h=["/"===t?"":t];u&&h.push(u);let g=["mode=presentation",`id=${d}`,`type=${o}`,`path=${encodeURIComponent(c)}`];return p&&g.push(`tool=${p}`),h.push("intent","edit",`${g.join(";")}?${f}`),h.join("/")}function resolveStudioBaseRoute(e){let t="string"==typeof e?e:e.baseUrl;return"/"!==t&&(t=t.replace(/\/$/,"")),"string"==typeof e?{baseUrl:t}:{...e,baseUrl:t}}let filterDefault=({sourcePath:e,resultPath:t,value:r})=>{if(isValidDate(r)||isValidURL(r))return!1;let n=e.at(-1);return!("slug"===e.at(-2)&&"current"===n||"string"==typeof n&&(n.startsWith("_")||n.endsWith("Id"))||e.some(e=>"meta"===e||"metadata"===e||"openGraph"===e||"seo"===e)||hasTypeLike(e)||hasTypeLike(t)||"string"==typeof n&&l.has(n))},l=new Set(["color","colour","currency","email","format","gid","hex","href","hsl","hsla","icon","id","index","key","language","layout","link","linkAction","locale","lqip","page","path","ref","rgb","rgba","route","secret","slug","status","tag","template","theme","type","textTheme","unit","url","username","variant","website"]);function isValidDate(e){return!!/^\d{4}-\d{2}-\d{2}/.test(e)&&!!Date.parse(e)}function isValidURL(e){try{new URL(e,e.startsWith("/")?"https://acme.com":void 0)}catch{return!1}return!0}function hasTypeLike(e){return e.some(e=>"string"==typeof e&&null!==e.match(/type/i))}function stegaEncodeSourceMap(e,t,r){let{filter:o,logger:s,enabled:a}=r;if(!a){let n="config.enabled must be true, don't call this function otherwise";throw s?.error?.(`[@sanity/client]: ${n}`,{result:e,resultSourceMap:t,config:r}),TypeError(n)}if(!t)return s?.error?.("[@sanity/client]: Missing Content Source Map from response body",{result:e,resultSourceMap:t,config:r}),e;if(!r.studioUrl){let n="config.studioUrl must be defined";throw s?.error?.(`[@sanity/client]: ${n}`,{result:e,resultSourceMap:t,config:r}),TypeError(n)}let l={encoded:[],skipped:[]},u=encodeIntoResult(e,t,({sourcePath:e,sourceDocument:t,resultPath:i,value:a})=>{if(("function"==typeof o?o({sourcePath:e,resultPath:i,filterDefault,sourceDocument:t,value:a}):filterDefault({sourcePath:e,resultPath:i,value:a}))===!1)return s&&l.skipped.push({path:toString(jsonPathToStudioPath(e)),value:`${a.slice(0,20)}${a.length>20?"...":""}`,length:a.length}),a;s&&l.encoded.push({path:toString(jsonPathToStudioPath(e)),value:`${a.slice(0,20)}${a.length>20?"...":""}`,length:a.length});let{baseUrl:u,workspace:p,tool:d}=resolveStudioBaseRoute("function"==typeof r.studioUrl?r.studioUrl(t):r.studioUrl);if(!u)return a;let{_id:c,_type:f,_projectId:h,_dataset:g}=t;return(0,n.C)(a,{origin:"sanity.io",href:createEditUrl({baseUrl:u,workspace:p,tool:d,id:c,type:f,path:e,...!r.omitCrossDatasetReferenceData&&{dataset:g,projectId:h}})},!1)});if(s){let e=l.skipped.length,t=l.encoded.length;if((e||t)&&((s?.groupCollapsed||s.log)?.("[@sanity/client]: Encoding source map into result"),s.log?.(`[@sanity/client]: Paths encoded: ${l.encoded.length}, skipped: ${l.skipped.length}`)),l.encoded.length>0&&(s?.log?.("[@sanity/client]: Table of encoded paths"),(s?.table||s.log)?.(l.encoded)),l.skipped.length>0){let e=new Set;for(let{path:t}of l.skipped)e.add(t.replace(i,"0").replace(/\[\d+\]/g,"[]"));s?.log?.("[@sanity/client]: List of skipped paths",[...e.values()])}(e||t)&&s?.groupEnd?.()}return u}var u=Object.freeze({__proto__:null,stegaEncodeSourceMap})}};